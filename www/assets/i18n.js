const translations = {
    es: {
        app_title: "SmartFinance",
        backup: "Backup",
        total_expense_month: "Gasto Total (Mes Actual)",
        transactions_count: "transacciones",
        attn_required: "Atención Requerida",
        touch_to_pay: "Toca una alerta para registrar el pago.",
        adv_reports: "Reportes Avanzados",
        config: "Configurar",
        reg_movement: "Registrar Movimiento",
        discard_back: "Descartar / Volver",
        date: "Fecha",
        category: "Categoría",
        select_option: "Seleccione...",
        group_subcat: "Grupo / Subcategoría",
        none: "---",
        linked_service: "Vinculado a Servicio:",
        no_service: "(Ninguno)",
        description: "Descripción",
        desc_placeholder: "Detalle del gasto",
        detailed_mode: "Modo Detallado (Cant * Unit)",
        qty: "Cant.",
        unit_value: "Valor Unitario",
        value: "Valor",
        total_pay: "Total a Pagar",
        save: "Guardar",
        update: "Actualizar",
        edit_movement: "Editar Movimiento",
        saved: "Guardado",
        error_missing_data: "Faltan datos obligatorios",
        no_desc: "Sin descripción",
        history: "Historial",
        export: "Exportar",
        delete: "Borrar",
        search_placeholder: "Buscar...",
        sort_date: "Fecha",
        sort_cat: "Categ.",
        sort_group: "Grupo",
        confirm_delete_many: "¿Borrar {n}?",
        irreversible: "Irreversible",
        smart_reports: "Reportes Inteligentes",
        from: "Desde",
        to: "Hasta",
        this_month: "Este Mes",
        three_months: "3 Meses",
        this_year: "Este Año",
        adv_filters: "Filtros Avanzados",
        categories: "Categorías",
        groups: "Grupos",
        clear_filters: "Limpiar Filtros",
        chart_type: "Gráfico",
        chart_bar: "Barras (Total Mensual)",
        chart_grouped: "Barras Agrupadas (Comparativo)",
        chart_stacked: "Barras Apiladas",
        chart_line: "Línea Tendencia",
        chart_doughnut: "Torta (Total)",
        total_period: "Total Periodo:",
        avg_monthly: "Promedio Mensual:",
        configuration: "Configuración",
        cats_groups: "Categorías y Grupos",
        new_cat: "+ Nueva Categoría",
        rec_services: "Servicios Recurrentes",
        new_service: "+ Nuevo Servicio",
        link_history: "Vincular Historial Automáticamente",
        test_notif: "Probar Notificación del Sistema",
        data_import: "Importación de Datos",
        backup_json: "Copia Seguridad (JSON)",
        history_csv: "Datos Históricos (CSV)",
        factory_reset: "Restablecer Datos de Fábrica",
        confirm_reset: "¿Restablecer todo?",
        warn_reset: "Se borrarán todos los datos. Irreversible.",
        btn_reset: "Sí, borrar todo",
        lang_select: "Idioma / Language",
        help_guide: "Guía de Uso",
        welcome_title: "Bienvenido a Mis Gastos",
        welcome_text: "Esta aplicación permite llevar el control detallado de tus finanzas personales, funcionando 100% offline.",
        help_reg_title: "Registro de Gastos",
        help_reg_text: "Usa el botón central (+) para agregar movimientos. Si seleccionas un Grupo vinculado a un servicio, la app lo detectará automáticamente.",
        help_alerts_title: "Alertas y Servicios",
        help_alerts_text: "Configura tus pagos recurrentes en Configuración. Frecuencias disponibles: Mensual, Bimestral.",
        help_sys_title: "Alertas del Sistema",
        help_sys_text: "El sistema monitorea tus servicios y te notifica 3 días antes del corte.",
        help_data_title: "Respaldo de Datos",
        help_data_text: "Tus datos son privados y viven en este dispositivo. Puedes exportar e importar backups.",
        edit_cat: "Editar Categoría",
        name: "Nombre",
        add_group: "+ Grupo",
        cancel: "Cancelar",
        month_total: "Gasto Mes",
        month_tx: "Movimientos",
        recent_activity: "Actividad Reciente",
        view_all: "Ver todo",
        reports: "Reportes",
        lbl_min_red: "Mínimo (Rojo)",
        lbl_goal_green: "Meta (Verde)",
        adjust_bal_label: "Saldo Sistema: $ {bal}. Ingresa tu saldo real:",
        cancel: "Cancelar",
        nav_home: "Inicio",
        nav_history: "Historial",
        cat_housing: "Vivienda",
        cat_services: "Servicios",
        cat_food: "Alimentos",
        cat_transport: "Transporte",
        freq_monthly: "Mensual",
        freq_bimonthly_odd: "Bimestral (Impar)",
        freq_bimonthly_even: "Bimestral (Par)",
        msg_process_done: "Proceso Terminado",
        msg_linked: "Se vincularon {n} registros antiguos.",
        msg_service_linked: "Servicio vinculado",
        err_in_use: "En uso",
        lbl_service_group: "Servicio (Grupo)",
        lbl_frequency: "Frecuencia",
        lbl_cost_type: "Tipo Costo",
        lbl_fixed: "Fijo",
        lbl_variable: "Variable",
        lbl_cost: "Costo ($)",
        lbl_cutoff: "Día Corte",
        warn_cat_not_found: "Categoría para \"{n}\" no encontrada. Selecciónala manual.",
        notice: "Aviso",
        common_edit: "Editar",
        common_new: "Nuevo",
        notif_title_payment: "Recordatorio de Pago",
        notif_body_days: "El servicio {n} vence en {d} días.",
        notif_body_today: "El servicio {n} vence HOY.",
        notif_body_overdue: "El servicio {n} está VENCIDO por {d} días.",
        notif_test_title: "Prueba de Sistema",
        notif_test_body: "Si ves esto, las notificaciones funcionan correctamente.",
        notif_scheduled_title: "Programada",
        notif_scheduled_text: "La notificación aparecerá en 2 segundos.",
        err_capacitor_web: "Capacitor no detectado (Modo Web?)",
        err_perm_denied: "Permiso denegado",
        err_perm_denied_text: "No se pueden mostrar notificaciones.",
        err_plugin: "Error Plugin",
        err_schedule: "No se pudo programar: ",
        backup_title: "Backup Gastos",
        backup_json_desc: "Archivo JSON",
        backup_dialog: "Guardar en...",
        msg_restored: "Restaurado",
        err_json_bad: "JSON mal",
        msg_processing_csv: "Procesando CSV...",
        msg_imported_csv: "Se importaron {n} registros desde CSV.",
        err_csv_invalid: "Formato CSV inválido.",
        err_no_export: "Nada que exportar",
        csv_header: "Fecha;Categoria;Grupo;Descripcion;Cantidad;Unitario;Total;Estado",
        csv_type_recurring: "Recurrente",
        csv_type_expense: "Gasto",
        lbl_vence_day: "Vence día {n}",
        lbl_vencido: "Vencido",
        lbl_pay: "Pagar",
        balance_options: "Opciones de Saldo",
        config_thresholds: "Configurar Semáforo",
        adjust_balance: "Ajustar Saldo",
        config_thresholds: "Configurar Semáforo",
        adjust_balance: "Ajustar Saldo",
        lbl_h_expenses: "GASTOS",
        lbl_h_incomes: "INGRESOS",
        lbl_h_expenses: "GASTOS",
        lbl_h_incomes: "INGRESOS",
        avail_balance: "Saldo Disponible",
        tab_expense: "Gasto",
        tab_income: "Ingreso",
        tab_income: "Ingreso",
        total_income: "Monto Ingreso",
        menu_help: "Ayuda / Guía",
        menu_about: "Acerca de",
        about_title: "Acerca de SmartFinance",
        copyright: "Copyright GabHoX ghdiez.01@gmail.com - 2025 todos los derechos reservados.",
        btn_close: "Cerrar",
        data_management: "Gestión de Datos",
        lbl_import: "Importar",
        lbl_export: "Exportar",
        help_cats_title: "Categorías y Grupos",
        help_cats_text: "Clasifica tus gastos. Puedes crear nuevas categorías o agregar grupos a las existentes.",
        help_backup_title: "Respaldo y Transferencia",
        help_backup_text: "Exporta tus datos para guardarlos o transferirlos a otro dispositivo.",
        btn_pivot: "Tabla Dinámica",
        chart_multiline: "Líneas Comparativas (Grupos)",
        lbl_category: "Categoría",
        lbl_group: "Grupo",
        err_fill_all: "Por favor complete todos los campos",
        pivot_rows: "Filas:",
        pivot_cols: "Columnas:",
        axis_cat: "Categoría",
        axis_group: "Grupo",
        axis_date: "Fecha",
        axis_month: "Mes",
        button: "Actualizar",
        help_reports_title: "Reportes Inteligentes",
        help_reports_text: "Visualiza tus gastos con gráficos interactivos. Usa 'Líneas Comparativas' para ver la evolución de grupos específicos.",
        help_pivot_title: "Tablas Dinámicas",
        help_reports_text: "Visualiza tus gastos con gráficos interactivos. Usa 'Líneas Comparativas' para ver la evolución de grupos específicos.",
        help_pivot_title: "Tablas Dinámicas",
        help_pivot_text: "Analiza a fondo. Cruza información (ej: Grupo vs Mes) para ver totatles detallados. Usa los selectores para cambiar filas y columnas.",
        link_service_optional: "Vincular a Servicio (Opcional)",
        loading_more: "Cargando más..."
    },
    en: {
        app_title: "SmartFinance",
        backup: "Backup",
        total_expense_month: "Total Expense (Current Month)",
        transactions_count: "transactions",
        attn_required: "Attention Required",
        touch_to_pay: "Tap an alert to record payment.",
        adv_reports: "Advanced Reports",
        config: "Settings",
        reg_movement: "Record Transaction",
        discard_back: "Discard / Back",
        date: "Date",
        category: "Category",
        select_option: "Select...",
        group_subcat: "Group / Subcategory",
        none: "---",
        linked_service: "Linked to Service:",
        no_service: "(None)",
        description: "Description",
        desc_placeholder: "Expense details",
        detailed_mode: "Detailed Mode (Qty * Unit)",
        qty: "Qty",
        unit_value: "Unit Value",
        value: "Value",
        total_pay: "Total to Pay",
        save: "Save",
        update: "Update",
        edit_movement: "Edit Transaction",
        saved: "Saved",
        error_missing_data: "Missing mandatory data",
        no_desc: "No description",
        history: "History",
        export: "Export",
        delete: "Delete",
        search_placeholder: "Search...",
        sort_date: "Date",
        sort_cat: "Cat.",
        sort_group: "Group",
        confirm_delete_many: "Delete {n}?",
        irreversible: "Irreversible",
        smart_reports: "Smart Reports",
        from: "From",
        to: "To",
        this_month: "This Month",
        three_months: "3 Months",
        this_year: "This Year",
        adv_filters: "Advanced Filters",
        categories: "Categories",
        groups: "Groups",
        clear_filters: "Clear Filters",
        chart_type: "Chart Type",
        chart_bar: "Bar (Monthly Total)",
        chart_grouped: "Grouped Bar (Comparative)",
        chart_stacked: "Stacked Bar",
        chart_line: "Trend Line",
        chart_doughnut: "Doughnut (Total)",
        total_period: "Period Total:",
        avg_monthly: "Monthly Average:",
        configuration: "Settings",
        cats_groups: "Categories & Groups",
        new_cat: "+ New Category",
        rec_services: "Recurring Services",
        new_service: "+ New Service",
        link_history: "Auto-link History",
        test_notif: "Test System Notification",
        data_import: "Data Import",
        backup_json: "Backup (JSON)",
        history_csv: "Historical Data (CSV)",
        factory_reset: "Factory Reset",
        confirm_reset: "Reset everything?",
        warn_reset: "All data will be erased. Irreversible.",
        btn_reset: "Yes, delete all",
        lang_select: "Idioma / Language",
        help_guide: "User Guide",
        welcome_title: "Welcome to My Expenses",
        welcome_text: "This app allows you to keep detailed control of your personal finances, working 100% offline.",
        help_reg_title: "Recording Expenses",
        help_reg_text: "Use the central (+) button to add transactions. If you select a Group linked to a service, the app will detect it automatically.",
        help_alerts_title: "Alerts & Services",
        help_alerts_text: "Configure your recurring payments in Settings. Available frequencies: Monthly, Bimonthly.",
        help_sys_title: "System Alerts",
        help_sys_text: "The system monitors your services and notifies you 3 days before the due date.",
        help_data_title: "Data Backup",
        help_data_text: "Your data is private and lives on this device. You can export and import backups.",
        edit_cat: "Edit Category",
        name: "Name",
        add_group: "+ Group",
        cancel: "Cancel",
        nav_home: "Home",
        nav_history: "History",
        cat_housing: "Housing",
        cat_services: "Utilities",
        cat_food: "Food",
        cat_transport: "Transport",
        freq_monthly: "Monthly",
        freq_bimonthly_odd: "Bimonthly (Odd)",
        freq_bimonthly_even: "Bimonthly (Even)",
        msg_process_done: "Process Finished",
        msg_linked: "{n} old records linked.",
        msg_service_linked: "Service linked",
        err_in_use: "In use",
        lbl_service_group: "Service (Group)",
        lbl_frequency: "Frequency",
        lbl_cost_type: "Cost Type",
        lbl_fixed: "Fixed",
        avail_balance: "Available Balance",
        tab_expense: "Expense",
        tab_income: "Income",
        tab_income: "Income",
        total_income: "Income Amount",
        menu_help: "Help / Guide",
        menu_about: "About",
        about_title: "About SmartFinance",
        copyright: "Copyright GabHoX ghdiez.01@gmail.com - 2025 all rights reserved.",
        btn_close: "Close",
        data_management: "Data Management",
        lbl_import: "Import",
        lbl_export: "Export",
        help_cats_title: "Categories & Groups",
        help_cats_text: "Classify your expenses. Create new categories or add groups to existing ones.",
        help_backup_title: "Backup & Transfer",
        help_backup_text: "Export your data to save it or transfer to another device.",
        btn_pivot: "Pivot Table",
        chart_multiline: "Comparison Lines (Groups)",
        lbl_category: "Category",
        lbl_group: "Group",
        err_fill_all: "Please fill all fields",
        pivot_rows: "Rows:",
        pivot_cols: "Columns:",
        axis_cat: "Category",
        axis_group: "Group",
        axis_date: "Date",
        axis_month: "Month",
        btn_update: "Update",
        help_reports_title: "Smart Reports",
        help_reports_text: "Visualize expenses with interactive charts. Use 'Comparison Lines' to track specific groups over time.",
        help_pivot_title: "Pivot Tables",
        help_pivot_text: "Deep analysis. Cross-reference data (e.g. Group vs Month). Use selectors to customize rows and columns.",
        lbl_variable: "Variable",
        lbl_cost: "Cost ($)",
        lbl_cutoff: "Cutoff Day",
        warn_cat_not_found: "Category for from \"{n}\" not found. Select manually.",
        notice: "Notice",
        common_edit: "Edit",
        common_new: "New",
        notif_title_payment: "Payment Reminder",
        notif_body_days: "Service {n} due in {d} days.",
        notif_body_today: "Service {n} due TODAY.",
        notif_body_overdue: "Service {n} OVERDUE by {d} days.",
        notif_test_title: "System Test",
        notif_test_body: "If you see this, notifications are working.",
        notif_scheduled_title: "Scheduled",
        notif_scheduled_text: "Notification will appear in 2 seconds.",
        err_capacitor_web: "Capacitor not detected (Web Mode?)",
        err_perm_denied: "Permission denied",
        err_perm_denied_text: "Cannot show notifications.",
        err_plugin: "Plugin Error",
        err_schedule: "Could not schedule: ",
        backup_title: "Expenses Backup",
        backup_json_desc: "JSON File",
        backup_dialog: "Save to...",
        msg_restored: "Restored",
        err_json_bad: "Bad JSON",
        msg_processing_csv: "Processing CSV...",
        msg_imported_csv: "Imported {n} records from CSV.",
        err_csv_invalid: "Invalid CSV format.",
        err_no_export: "Nothing to export",
        csv_header: "Date;Category;Group;Description;Quantity;Unit;Total;Status",
        csv_type_recurring: "Recurring",
        csv_type_expense: "Expense",
        lbl_vence_day: "Due day {n}",
        lbl_vencido: "Overdue",
        lbl_pay: "Pay",
        balance_options: "Balance Options",
        config_thresholds: "Config Thresholds",
        adjust_balance: "Adjust Balance",
        month_total: "Month Expense",
        month_tx: "Transactions",
        recent_activity: "Recent Activity",
        view_all: "View All",
        reports: "Reports",
        lbl_min_red: "Minimum (Red)",
        lbl_goal_green: "Goal (Green)",
        adjust_bal_label: "System Balance: $ {bal}. Enter real balance:",
        lbl_h_expenses: "EXPENSES",
        lbl_h_incomes: "INCOME",
        link_service_optional: "Link to Service (Optional)",
        loading_more: "Loading more..."
    },
    pt: {
        app_title: "SmartFinance",
        backup: "Backup",
        total_expense_month: "Despesa Total (Mês Atual)",
        transactions_count: "transações",
        attn_required: "Atenção Necessária",
        touch_to_pay: "Toque em um alerta para registrar o pagamento.",
        adv_reports: "Relatórios Avançados",
        config: "Configurações",
        reg_movement: "Registrar Movimento",
        discard_back: "Descartar / Voltar",
        date: "Data",
        category: "Categoria",
        select_option: "Selecione...",
        group_subcat: "Grupo / Subcategoria",
        none: "---",
        linked_service: "Vinculado ao Serviço:",
        no_service: "(Nenhum)",
        description: "Descrição",
        desc_placeholder: "Detalhes da despesa",
        detailed_mode: "Modo Detalhado (Qtd * Unit)",
        qty: "Qtd.",
        unit_value: "Valor Unitário",
        value: "Valor",
        total_pay: "Total a Pagar",
        save: "Salvar",
        update: "Atualizar",
        edit_movement: "Editar Movimento",
        saved: "Salvo",
        error_missing_data: "Faltam dados obrigatórios",
        no_desc: "Sem descrição",
        history: "Histórico",
        export: "Exportar",
        delete: "Excluir",
        search_placeholder: "Buscar...",
        sort_date: "Data",
        sort_cat: "Categ.",
        sort_group: "Grupo",
        confirm_delete_many: "Excluir {n}?",
        irreversible: "Irreversível",
        smart_reports: "Relatórios Inteligentes",
        from: "De",
        to: "Até",
        this_month: "Este Mês",
        three_months: "3 Meses",
        this_year: "Este Ano",
        adv_filters: "Filtros Avançados",
        categories: "Categorias",
        groups: "Grupos",
        clear_filters: "Limpar Filtros",
        chart_type: "Tipo de Gráfico",
        chart_bar: "Barra (Total Mensal)",
        chart_grouped: "Barras Agrupadas (Comparativo)",
        chart_stacked: "Barras Empilhadas",
        chart_line: "Linha de Tendência",
        chart_doughnut: "Rosca (Total)",
        total_period: "Total do Período:",
        avg_monthly: "Média Mensal:",
        configuration: "Configurações",
        cats_groups: "Categorias e Grupos",
        new_cat: "+ Nova Categoria",
        rec_services: "Serviços Recorrentes",
        new_service: "+ Novo Serviço",
        link_history: "Vincular Histórico Automaticamente",
        test_notif: "Testar Notificação do Sistema",
        data_import: "Importação de Dados",
        backup_json: "Backup (JSON)",
        history_csv: "Dados Históricos (CSV)",
        factory_reset: "Restaurar Dados de Fábrica",
        confirm_reset: "Restaurar tudo?",
        warn_reset: "Todos os dados serão apagados. Irreversível.",
        btn_reset: "Sim, apagar tudo",
        lang_select: "Idioma / Language",
        help_guide: "Guia de Uso",
        welcome_title: "Bem-vindo ao Minhas Despesas",
        welcome_text: "Este aplicativo permite o controle detalhado de suas finanças pessoais, funcionando 100% offline.",
        help_reg_title: "Registro de Despesas",
        help_reg_text: "Use o botão central (+) para adicionar movimentos. Se você selecionar um Grupo vinculado a um serviço, o app detectará automaticamente.",
        help_alerts_title: "Alertas e Serviços",
        help_alerts_text: "Configure seus pagamentos recorrentes em Configurações. Frequências disponíveis: Mensal, Bimestral.",
        help_sys_title: "Alertas do Sistema",
        help_sys_text: "O sistema monitora seus serviços e notifica 3 dias antes do vencimento.",
        help_data_title: "Backup de Dados",
        help_data_text: "Seus dados são privados e ficam neste dispositivo. Você pode exportar e importar backups.",
        edit_cat: "Editar Categoria",
        name: "Nome",
        add_group: "+ Grupo",
        cancel: "Cancelar",
        nav_home: "Início",
        nav_history: "Histórico",
        cat_housing: "Moradia",
        cat_services: "Serviços",
        cat_food: "Alimentação",
        cat_transport: "Transporte",
        freq_monthly: "Mensal",
        freq_bimonthly_odd: "Bimestral (Ímpar)",
        freq_bimonthly_even: "Bimestral (Par)",
        msg_process_done: "Processo Concluído",
        msg_linked: "{n} registros antigos vinculados.",
        msg_service_linked: "Serviço vinculado",
        err_in_use: "Em uso",
        lbl_service_group: "Serviço (Grupo)",
        lbl_frequency: "Frequência",
        lbl_cost_type: "Tipo de Custo",
        lbl_fixed: "Fixo",
        lbl_variable: "Variável",
        lbl_cost: "Custo ($)",
        lbl_cutoff: "Dia de Corte",
        warn_cat_not_found: "Categoria para \"{n}\" não encontrada. Selecione manualmente.",
        notice: "Aviso",
        common_edit: "Editar",
        common_new: "Novo",
        notif_title_payment: "Lembrete de Pagamento",
        notif_body_days: "Serviço {n} vence em {d} dias.",
        notif_body_today: "Serviço {n} vence HOJE.",
        notif_body_overdue: "Serviço {n} VENCIDO há {d} dias.",
        notif_test_title: "Teste do Sistema",
        notif_test_body: "Se você ver isso, as notificações estão funcionando.",
        notif_scheduled_title: "Agendada",
        notif_scheduled_text: "A notificação aparecerá em 2 segundos.",
        err_capacitor_web: "Capacitor não detectado (Modo Web?)",
        err_perm_denied: "Permissão negada",
        err_perm_denied_text: "Não é possível mostrar notificações.",
        err_plugin: "Erro no Plugin",
        err_schedule: "Não foi possível agendar: ",
        backup_title: "Backup Despesas",
        backup_json_desc: "Arquivo JSON",
        backup_dialog: "Salvar em...",
        msg_restored: "Restaurado",
        err_json_bad: "JSON Ruim",
        msg_processing_csv: "Processando CSV...",
        msg_imported_csv: "{n} registros importados do CSV.",
        err_csv_invalid: "Formato CSV inválido.",
        err_no_export: "Nada para exportar",
        csv_header: "Data;Categoria;Grupo;Descricao;Quantidade;Unitario;Total;Estado",
        csv_type_recurring: "Recorrente",
        csv_type_expense: "Despesa",
        lbl_vence_day: "Vence dia {n}",
        lbl_vencido: "Vencido",
        lbl_pay: "Pagar",
        balance_options: "Opções de Saldo",
        config_thresholds: "Configurar Semáforo",
        adjust_balance: "Ajustar Saldo",
        lbl_h_expenses: "DESPESAS",
        lbl_h_incomes: "RECEITAS",
        avail_balance: "Saldo Disponível",
        tab_expense: "Despesa",
        tab_income: "Receita",
        total_income: "Valor da Receita",
        menu_help: "Ajuda / Guia",
        menu_about: "Sobre",
        about_title: "Sobre SmartFinance",
        copyright: "Copyright GabHoX ghdiez.01@gmail.com - 2025 todos os direitos reservados.",
        btn_close: "Fechar",
        data_management: "Gestão de Dados",
        lbl_import: "Importar",
        lbl_export: "Exportar",
        help_cats_title: "Categorias e Grupos",
        help_cats_text: "Classifique suas despesas. Crie novas categorias ou adicione grupos às existentes.",
        month_total: "Despesa Do Mês",
        month_tx: "Movimentos",
        recent_activity: "Atividade Recente",
        view_all: "Ver tudo",
        reports: "Relatórios",
        lbl_min_red: "Mínimo (Vermelho)",
        lbl_goal_green: "Meta (Verde)",
        adjust_bal_label: "Saldo Sistema: $ {bal}. Insira saldo real:",
        help_backup_title: "Backup e Transferência",
        help_backup_text: "Exporte seus dados para salvá-los ou transferi-los para outro dispositivo.",
        btn_pivot: "Tabela Dinâmica",
        chart_multiline: "Linhas Comparativas (Grupos)",
        lbl_category: "Categoria",
        lbl_group: "Grupo",
        err_fill_all: "Por favor, preencha todos os campos",
        pivot_rows: "Linhas:",
        pivot_cols: "Colunas:",
        axis_cat: "Categoria",
        axis_group: "Grupo",
        axis_date: "Data",
        axis_month: "Mês",
        btn_update: "Atualizar",
        help_reports_title: "Relatórios Inteligentes",
        help_reports_text: "Visualize despesas com gráficos interativos. Use 'Linhas Comparativas' para ver a evolução de grupos.",
        help_pivot_title: "Tabelas Dinâmicas",
        help_pivot_text: "Análise profunda. Cruize informações (ex: Grupo vs Mês). Use os seletores para personalizar linhas e colunas.",
        link_service_optional: "Vincular a Serviço (Opcional)",
        loading_more: "Carregando mais..."
    }
};

const I18n = {
    currentLang: 'es',
    init: () => {
        const saved = localStorage.getItem('gastosApp_lang');
        if (saved && translations[saved]) {
            I18n.currentLang = saved;
        } else {
            const browserLang = navigator.language.split('-')[0];
            if (translations[browserLang]) I18n.currentLang = browserLang;
        }
        I18n.updatePage();
    },

    t: (key, params = {}) => {
        if (!translations[I18n.currentLang]) return key; // Safety check
        let str = translations[I18n.currentLang][key] || key;
        for (const [k, v] of Object.entries(params)) {
            str = str.replace(`{${k}}`, v);
        }
        return str;
    },

    toggleLanguage: () => {
        const langs = ['es', 'en', 'pt'];
        const next = langs[(langs.indexOf(I18n.currentLang) + 1) % langs.length];
        I18n.setLanguage(next);
    },

    setLanguage: (lang) => {
        if (!translations[lang]) return;
        I18n.currentLang = lang;
        localStorage.setItem('gastosApp_lang', lang);
        I18n.updatePage();

        // Update Flag
        const flags = { 'es': 'assets/flags/co.png', 'en': 'assets/flags/us.png', 'pt': 'assets/flags/br.png' };
        const btn = document.getElementById('btn-lang-toggle');
        if (btn) btn.innerHTML = `<img src="${flags[lang]}" style="width: 60px !important; height: 42px !important; max-width: none !important;" class="rounded shadow-md border border-white object-cover">`;

        if (window.UI) {
            UI.renderCategoriesSelect();
            UI.renderServicesConfig();
            UI.renderHistory();
            UI.updateDashboard();
            UI.renderReports();
            UI.renderCategoriesConfig();
        }

        if (window.App && App.translateDefaults) App.translateDefaults(lang);
    },

    updatePage: () => {
        // Update Flag on Init
        const flags = { 'es': 'assets/flags/co.png', 'en': 'assets/flags/us.png', 'pt': 'assets/flags/br.png' };
        const btn = document.getElementById('btn-lang-toggle');
        if (btn && flags[I18n.currentLang]) btn.innerHTML = `<img src="${flags[I18n.currentLang]}" style="width: 60px !important; height: 42px !important; max-width: none !important;" class="rounded shadow-md border border-white object-cover">`;

        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            const placeholder = el.getAttribute('data-i18n-placeholder');

            if (key) el.innerText = I18n.t(key);
            if (placeholder) el.placeholder = I18n.t(placeholder);
        });
        document.documentElement.lang = I18n.currentLang;
    }
};
window.I18n = I18n;
